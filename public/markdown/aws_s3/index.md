---
folderName: aws_s3
title: S3
tag: aws
isPublished: false
---

# S3

## 1. S3의 구조와 탐색 (`ListObjectsV2Command`)

S3는 전통적인 파일 시스템과 달리 실제 폴더 구조가 없는 객체 스토리지입니다.

### 파일 시스템 시뮬레이션

- 객체 키(Key): `documents/report.pdf`와 같이 전체 경로가 곧 파일의 이름(Key)이 됩니다.
- Delimiter: `/`를 구분자(Delimiter)로 지정하면, S3는 이를 기준으로 하위 폴더처럼 보이는 객체들을 묶어서 반환합니다.

### 주요 파라미터 및 반환값

- Prefix: 특정 접두사(폴더 경로)로 시작하는 객체만 필터링하여 조회합니다.
- Delimiter: 폴더 구조를 시뮬레이션하기 위한 구분자입니다 (보통 `/` 사용).
- Contents: 실제 파일(객체)들의 메타데이터 리스트입니다.
- CommonPrefixes: `Delimiter` 기준으로 묶인 '폴더'들의 리스트입니다.

---

## 2. S3 액세스 제어 (Access Control)

S3의 보안은 "누가(Who)", "무엇을(What)", "어떻게(How)" 접근하는지를 결정하는 4가지 핵심 요소로 구성됩니다.

### 1) IAM (Identity and Access Management) - "사용자 신분증"

가장 권장되는 방식이자 현재 프로젝트(`wecruit-landing`)에서 사용하는 방식입니다.

- 개념: AWS 리소스에 접근할 수 있는 '사용자(User)'나 '역할(Role)'을 만들고 권한을 부여합니다.
- 구조: IAM User 생성 → Access Key 발급 → Policy(권한) 연결.
- 장점: 버킷 자체를 퍼블릭하게 열지 않아도, 키를 가진 서버만 안전하게 접근할 수 있습니다.

### 2) 버킷 정책 (Bucket Policy) - "버킷의 문지기"

버킷 전체에 적용되는 JSON 형태의 규칙입니다.

- 용도: 특정 IP 허용, 퍼블릭 읽기 허용(정적 웹 호스팅), CloudFront 연동 등.

### 3) ACL (Access Control List) - "개별 파일의 꼬리표"

- 상태: Legacy 방식. 최근에는 비활성화(Bucket Owner Enforced)를 권장합니다.
- 단점: 파일마다 권한을 관리해야 하므로 복잡하고, 보안 사고 위험이 높습니다.

### 4) 퍼블릭 액세스 차단 (Block Public Access, BPA) - "2중 잠금장치"

실수로 버킷을 공개해버리는 사고를 막기 위한 최상위 안전장치입니다. 버킷 정책이나 ACL보다 우선순위가 높습니다.

#### BPA의 4가지 옵션 (모두 True 권장)

1. 새 ACL 차단: 앞으로 누군가 ACL로 파일을 공개하려 하면 막습니다.
2. 임의의 ACL 차단: 기존에 ACL로 공개된 파일이 있어도 무시하고 차단합니다.
3. 새 퍼블릭 정책 차단: 버킷 정책에 "모두에게 공개" 내용을 저장하지 못하게 막습니다.
4. 임의의 퍼블릭 정책 차단: 기존에 "모두에게 공개" 정책이 있어도 무시하고 차단합니다.

---

## 3. 심화 개념: 액세스 지점 (Access Points)

"버킷 하나에 여러 개의 전용 출입구 만들기"

기본적으로 S3 버킷은 하나의 주소와 정책을 가집니다. 하지만 여러 팀이 하나의 거대한 버킷을 공유할 때 정책 관리가 복잡해지는데, 이때 액세스 지점을 사용합니다.

### 비유

- 버킷: 거대한 창고 건물 하나.
- 버킷 정책: 정문 경비실의 출입 명부. (사람이 많아지면 관리가 힘듦)
- 액세스 지점: 건물 옆에 뚫어놓은 '재무팀 전용 쪽문', '개발팀 전용 쪽문'.

### 사용 이유

1. 정책 분리: `Finance-AP`(재무팀)에는 재무 폴더 권한만, `Dev-AP`(개발팀)에는 로그 폴더 권한만 부여하여 관리를 분리합니다.
2. 네트워크 제한: 특정 액세스 지점은 VPC(내부망)에서만 접근 가능하도록 제한할 수 있습니다.

---

## 4. 프로젝트 적용 (`wecruit-landing`)

현재 프로젝트는 IAM User + Access Key 방식을 사용하여 가장 안전한 구조를 취하고 있습니다.

1. Next.js 서버 (Build Time): `.env`에 있는 `S3_ACCESS_KEY`, `S3_SECRET_KEY`를 사용합니다.
2. 요청 흐름: `S3Client`가 이 키를 이용해 AWS에 "나 권한 있는 사용자야"라고 서명된 요청을 보냅니다.
3. 보안 상태:
   - BPA: 모두 켜져 있어도(차단) 상관없습니다. (인증된 요청이므로)
   - 액세스 지점: 단일 애플리케이션이므로 불필요합니다. IAM User 권한만으로 충분합니다.

결론: 버킷을 외부에 공개하지 않으면서(Private), 서버만 안전하게 데이터를 가져오는 방식입니다.
